{% extends "base.html" %}

{% block title %}Veranstaltungen - Vaple{% endblock %}

{% block content %}
    <h1>Veranstaltungen</h1>
    <div class="filters">
      <div class="quicklinks">
        {% for link in quicklinks %}
        <a href="?from={{ link.date_from.isoformat }}&to={{ link.date_to.isoformat }}">{{ link.title }}</a>
        {% endfor %}
      </div>
      <form method="get" class="pat-autosubmit">
        <label for="from">Von</label><input name="from" type="date" value="{{ date_from.isoformat }}" />
        <label for="to">Bis</label><input name="to" type="date" value="{{ date_to.isoformat }}" />
        <input type="submit" value="Filtern" />
      </form>
    </div>
    <table class='event-list' id="event-list">
        <tr>
            <th>Datum</th>
            <th>Mitarbeiter</th>
            <th class="save"></th>
        {% for name in verbose_names %}
            <th>{{ name }}</th>
        {% endfor %}
        </tr>
    {% for eventdate, event, eventdate_form, event_form in object_list %}
        <tr>
            <td>
                <form id="eventdate-form-{{ eventdate.id }}" method="post" class="xpat-autosubmit"
                      action="{% url 'vaple_core:update_event_date' eventdate.id %}#eventdate-form-{{ eventdate.id }}::element">
                    {% csrf_token %}
                    <input name="date" type="date" value="{{ eventdate.date.isoformat }}" />
                    <input name="event" type="hidden" value="{{ event.id }}" />
                    <input type="submit" value="Speichern" class="save eventdate">
                </form>
                <form id="eventdate-add-form-{{ eventdate.id }}" method="post" action="{% url 'vaple_core:add_event_date' %}">
                    {% csrf_token %}
                    <input name="event" type="hidden" value="{{ event.id }}" />
                    <input name="date" type="hidden" value="{{ eventdate.date.isoformat }}" />
                    <input type="submit" value="Hinzufügen">
                </form>
            </td>
            <form id="eventdate-employees-form-{{ eventdate.id }}" method="post" class="xpat-autosubmit"
                  action="{% url 'vaple_core:update_event_date' eventdate.id %}#event-list">
                {% csrf_token %}
                <input name="event" type="hidden" value="{{ event.id }}" />
                <input name="date" type="hidden" value="{{ eventdate.date.isoformat }}" />
                {{ eventdate_form.as_table_row }}
                <td class="save employees">
                    <input type="submit" value="Speichern">
                </td>
            </form>
            <form id="event-form-{{ event.id }}" method="post" class="xpat-autosubmit" action="{% url 'vaple_core:update_event' event.id %}">
              {% csrf_token %}
              {{ event_form.as_table_row }}
              <td></td>
              <td class="save event"><input type="submit" value="Speichern"></td>
            </form>
        </tr>
        <tr>

            {% if event.eventdate_set.all|length > 1 %}
            <form method="post" action="{% url 'vaple_core:delete_event_date' eventdate.id %}">
              {% csrf_token %}
              <td><input type="submit" value="Entfernen"></td>
            </form>
            {% else %}
            <form method="post" action="{% url 'vaple_core:delete_event' event.id %}">
              {% csrf_token %}
              <td><input type="submit" value="Löschen"></td>
            </form>
            {% endif %}
        </tr>
    {% empty %}
        <p>Keine Veranstaltungen mit den gewählten Kriterien gefunden.</p>
    {% endfor %}
    {% for event, form in orphans %}
        <tr>
          <td>
              <form id="eventdate-add-form-{{ event.id }}" method="post" action="{% url 'vaple_core:add_event_date' %}">
                  {% csrf_token %}
                  <input name="event" type="hidden" value="{{ event.id }}" />
                  <input name="date" type="date" value="{{ today }}" />
                  <input type="submit" value="Speichern">
              </form>
          </td>
          <td>
          </td>
          <td>
          </td>
          <form method="post" action="{% url 'vaple_core:update_event' event.id %}">
            {% csrf_token %}
            {{ form.as_table_row }}
            <td></td>
            <td><input type="submit" value="Speichern"></td>
          </form>
          <form method="post" action="{% url 'vaple_core:delete_event' event.id %}">
            {% csrf_token %}
            <td><input type="submit" value="Löschen"></td>
          </form>

        </tr>
    {% endfor %}
    </table>
    <form method="post" action="{% url 'vaple_core:add_event' %}">
        {% csrf_token %}
        <input name="title" type="hidden" value="Neue Veranstaltung" />
        <input name="room" type="hidden" value="" />
        <input name="sound_type" type="hidden" value="NONE" />
        <input type="submit" value="Neu">
    </form>
{% endblock %}
